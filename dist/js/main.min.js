!function(){"use strict";angular.module("ionicCost",["ngAnimate","duScroll","angular-google-analytics"]).run(function(Analytics){Analytics.set("anonymizeIp",!0)}).config(function(AnalyticsProvider){AnalyticsProvider.setAccount("UA-44618885-7"),AnalyticsProvider.trackPages(!0)})}(),function(){"use strict";angular.module("ionicCost").controller("AppCtrl",["$scope","$location","$configurator","$document","$timeout","$http","Analytics",function($scope,$location,$configurator,$document,$timeout,$http,Analytics){$scope.data={},$scope.ui={link:null},$scope.data.screens={num:4},$scope.data.languages={num:1},$scope.data.orientations={portrait:1,landscape:0},$scope.data.devices={phone:1,tablet:0},$scope.data.controls="standard",$scope.data.quality="production",$scope.data.graphics={"graphics.splash":1,"graphics.appicon":1},$scope.data.platforms={ios:1,android:0},$scope.featuresList=["auth","data","api-integration","device","media","communication","geo","social","graphics","deployment","services-integration","ecommerce"];var notifyError=function(msg){var bigbox=humane.create({baseCls:"humane-flatty",timeout:0,clickToClose:!0});bigbox.error=bigbox.spawn({addnCls:"humane-flatty-error"}),bigbox.error(msg)},notifySuccess=function(msg){var bigbox=humane.create({baseCls:"humane-flatty",timeout:2e3,clickToClose:!1});bigbox.success=bigbox.spawn({addnCls:"humane-flatty-success"}),bigbox.success(msg)};$scope.waitingServer=!1;var baseApi="http://localhost:8000/";$scope.requestPermalink=function(){Analytics.trackEvent("estimate","requested-permalink"),$scope.waitingServer=!0,$http.post(baseApi+"estimates/new/",{email:$scope.ui.email,config:$scope.data,estimate:$scope.estimate,estimated_cost:$scope.estimate.price}).then(function(resp){notifySuccess("Permalink sent!"),$scope.ui.link=resp.data.link})["catch"](function(err){notifyError("Error sending permalink. Sorry, try later"),$scope.ui.link=null})["finally"](function(){$scope.waitingServer=!1})},$scope.getPermalinkData=function(link){$scope.waitingServer=!0,$http.get(baseApi+"estimates/get/"+link+"/").then(function(resp){$scope.data=resp.data.config,$scope.ui.link=resp.data.link_url,notifySuccess("Data loaded from permalink :)"),Analytics.trackEvent("estimate","load-permalink",link)})["catch"](function(err){notifyError("Sorry, cannot load data from given permalink!"),Analytics.trackEvent("estimate","load-permalink-error",link)})["finally"](function(){$scope.waitingServer=!1})},$scope.toggleBottom=function(){return $scope.errors.length?void($scope.bottomPanel=!1):void($scope.bottomPanel=!$scope.bottomPanel)};$configurator.getConfig().then(function(options){$scope.featureOptions=options,updateEstimate()}),$scope.estimate={price:null},$scope.errors=[],$scope.errorsFields={};var updateEstimate=function(){if($scope.errors=[],$scope.errorsFields={},$scope.featureOptions&&($scope.data.platforms.ios||$scope.data.platforms.android||($scope.errors.push("platforms"),$scope.errorsFields.platforms="Please select at least one platform!"),$scope.data.devices.phone||$scope.data.devices.tablet||($scope.errors.push("devices"),$scope.errorsFields.devices="Please select at least one device type!"),$scope.data.orientations.portrait||$scope.data.orientations.landscape||($scope.errors.push("orientations"),$scope.errorsFields.orientations="Please select at least one orientation!"),(!$scope.data.screens.num||parseInt($scope.data.screens.num)<1)&&($scope.errors.push("screens"),$scope.errorsFields.screens="Please add at least one screen!"),(!$scope.data.languages.num||parseInt($scope.data.languages.num)<1)&&($scope.errors.push("languages"),$scope.errorsFields.languages="Please add at least one language!"),!_.keys($scope.errorsFields).length)){var estimate={price:null};estimate.scaffolding={nav:$configurator.getFeatureCost("scaffolding","scaffolding.nav"),screens:$configurator.getFeatureCost("scaffolding","scaffolding.screens")*$scope.data.screens.num},estimate.features={},estimate.numFeatures=0,estimate.multipliers={screen:1,overall:1},estimate.multipliers.quality=$configurator.getMultiplier("quality."+$scope.data.quality);var dd=$configurator.getMultiplier("device.phone")*$scope.data.devices.phone+$configurator.getMultiplier("device.tablet")*$scope.data.devices.tablet;estimate.multipliers.devices=Math.max(dd-1,1);var or=$scope.data.orientations.landscape+$scope.data.orientations.portrait;1==or&&(estimate.multipliers.orientations=$configurator.getMultiplier("orientation.one")),2==or&&(estimate.multipliers.orientations=$configurator.getMultiplier("orientation.two")),estimate.multipliers.languages=Math.max(($scope.data.languages.num-1)*$configurator.getMultiplier("languages.num"),1),estimate.multipliers.controls=$configurator.getMultiplier("controls."+$scope.data.controls);var numPlatforms=$scope.data.platforms.ios+$scope.data.platforms.android;estimate.multipliers.platforms=Math.max((numPlatforms-1)*$configurator.getMultiplier("platforms.num"),1),estimate.multipliers.screen=estimate.multipliers.devices*estimate.multipliers.orientations*estimate.multipliers.controls,estimate.multipliers.overall=estimate.multipliers.quality*estimate.multipliers.languages*estimate.multipliers.platforms,estimate.scaffolding.total=estimate.scaffolding.nav+estimate.scaffolding.screens;var fts=$scope.featuresList,featuresTotal=0;_.each(fts,function(fgroup){var t=0,d=$scope.data[fgroup];d&&(_.each(d,function(value,code){var featureCost=$configurator.getFeatureCost(fgroup,code),cost=featureCost*parseInt(value);parseInt(value)&&(estimate.numFeatures+=1),cost&&(t+=cost,featuresTotal+=cost)}),estimate.features[fgroup]=t)}),estimate.featuresTotal=featuresTotal,estimate.scaffolding.totalCorrected=estimate.scaffolding.total*estimate.multipliers.screen,estimate.basePrice=estimate.scaffolding.totalCorrected+estimate.featuresTotal,estimate.price=parseInt(estimate.basePrice*estimate.multipliers.overall),$scope.estimate=estimate}};$scope.$watch("data",function(nv,ov){angular.equals(nv,ov)||(updateEstimate(),$scope.ui.link=null)},!0);var updateTopBar=function(){$timeout(function(){$scope.upperBar=$document.scrollTop()>40?!0:!1})};window.onscroll=updateTopBar,$document.on("scroll",updateTopBar);var s=$location.search();s.code&&$scope.getPermalinkData(s.code)}])}(),function(){"use strict";angular.module("ionicCost").directive("selectedItem",["$timeout",function($timeout){return{restrict:"A",require:"ngModel",link:function(scope,iElement,iAttrs,ngModelController){function updateModel(){$timeout(function(){var val=ngModelController.$viewValue?0:1;ngModelController.$setViewValue(val),ngModelController.$render(),iAttrs.reset&&!val&&scope.$eval(iAttrs.reset),iAttrs.set&&val&&scope.$eval(iAttrs.set)})}ngModelController.$render=function(){ngModelController.$viewValue?iElement.addClass("cherry"):iElement.removeClass("cherry")},ngModelController.$render(),iElement.on("click",function(){updateModel()})}}}]).directive("selectedItemValue",["$timeout",function($timeout){return{restrict:"A",require:"ngModel",link:function(scope,iElement,iAttrs,ngModelController){function updateModel(){$timeout(function(){ngModelController.$setViewValue(xvalue),ngModelController.$render()})}var xvalue=iAttrs.value;ngModelController.$render=function(){console.log(),ngModelController.$viewValue==xvalue?iElement.addClass("cherry"):iElement.removeClass("cherry")},ngModelController.$render(),iElement.on("click",function(nv){updateModel()})}}}]).directive("optionInput",["$timeout",function($timeout){return{restrict:"A",replace:!0,templateUrl:"templates/option.html",link:function(scope,iElement,iAttrs){}}}])}(),function(){"use strict";angular.module("ionicCost").factory("$configurator",["$q",function($q){var svc={};return svc.getConfig=function(){var deferred=$q.defer();return d3.csv("config/features.csv",function(rows){svc.groups=_.groupBy(rows,"category"),d3.csv("config/multipliers.csv",function(multipliers){svc.multipliers=multipliers,deferred.resolve(svc.groups)})}),deferred.promise},svc.getFeatureCost=function(group,code){if(!svc.groups)return null;if(!svc.groups[group])return null;var g=svc.groups[group],x=_.findWhere(g,{code:code});return x?parseInt(x.cost):null},svc.getMultiplier=function(code){if(!svc.multipliers)return null;var x=_.findWhere(svc.multipliers,{code:code});return x?parseFloat(x.value.replace(",",".")):null},svc}])}();